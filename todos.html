<!DOCTYPE html><html lang="en" class="no-code"><head><title>todos</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content=""><meta name="groc-document-path" content="todos"><meta name="groc-project-path" content="documentation/todos.md"><meta name="groc-github-url" content="https://github.com/cha0s/shrub"><link rel="stylesheet" type="text/css" media="all" href="assets/style.css"><script type="text/javascript" src="assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/cha0s/shrub/blob/master/documentation/todos.md">documentation/todos.md</a></div></div><div id="document"><div class="segment"><div class="comments"><div class="wrapper"><h1 id="todo-list">TODO list</h1>

<p>Shrub -- like any project -- always presents a path for improvement. This is
a dynamically generated listing of TODO items, each with a line of code
context.</p>

<p><a href="./client/modules/errors.html">client/modules/errors.coffee</a></p>

<ul>
<li><h4 id="constructormessage"><code>constructor: (@message) -&gt;</code></h4>

<p>Capture all arguments, and make the necessity for implementing toJSON obsolete. </p></li>
</ul>

<p><a href="./client/modules/packages/core/index.html">client/modules/packages/core/index.coffee</a></p>

<ul>
<li><h4 id="routecontrollerroutecontroller"><code>routeController = route.controller</code></h4>

<p>Define a routeController middleware stack for this. </p></li>
<li><h4 id="routetemplate"><code>route.template ?= ' '</code></h4>

<p>Some method of allowing <code>templateUrl</code>. </p></li>
</ul>

<p><a href="./client/modules/packages/form/index.html">client/modules/packages/form/index.coffee</a></p>

<ul>
<li><h4 id="fornamefieldofformspec"><code>for name, field of formSpec</code></h4>

<p>Form field types should be defined by hook. </p></li>
<li><h4 id="iffieldrpc"><code>if field.rpc?</code></h4>

<p>This should be middleware'd, <code>rpc</code> should be implementing it. </p></li>
</ul>

<p><a href="./client/modules/packages/rpc/index.html">client/modules/packages/rpc/index.coffee</a></p>

<ul>
<li><h4 id="callhangupunlessnavigatoruseragentmatchnodejsd"><code>call 'hangup' unless navigator.userAgent.match /^Node\.js .*$/</code></h4>

<p>This should be in a client-side <code>angular</code> package. </p></li>
</ul>

<p><a href="./client/modules/packages/socket/index.html">client/modules/packages/socket/index.coffee</a></p>

<ul>
<li><h4 id="socketioconnect"><code>socket = io.connect()</code></h4>

<p>Only Socket.IO at the moment. </p></li>
<li><h4 id="debuglisteners"><code>debugListeners = {}</code></h4>

<p>Remove after client logging. </p></li>
<li><h4 id="debuglistenersoneventname"><code>debugListeners["on-#{eventName}"] ?= (-&gt;</code></h4>

<p>Remove after client logging. </p></li>
<li><h4 id="ifconfiggetdebugging"><code>if config.get 'debugging'</code></h4>

<p>Remove after client logging. </p></li>
<li><h4 id="ifconfiggetdebugging"><code>if config.get 'debugging'</code></h4>

<p>Remove after client logging. </p></li>
</ul>

<p><a href="./client/modules/packages/ui/nav.html">client/modules/packages/ui/nav.coffee</a></p>

<ul>
<li><h4 id="scopelinkslinks"><code>scope.links = links</code></h4>

<p>This whole thing needs to be overhauled. </p></li>
<li><h4 id="exportsdservice"><code>exports.$service = -&gt; [</code></h4>

<p>Overhaul this. </p></li>
</ul>

<p><a href="./client/modules/packages/user/index.html">client/modules/packages/user/index.coffee</a></p>

<ul>
<li><h4 id="userhaspermissionpermfalse"><code>User::hasPermission = (perm) -&gt; false</code></h4>

<p>Access control structure. </p></li>
<li><h4 id="serviceloginmethodusernamepassword"><code>service.login = (method, username, password) -&gt;</code></h4>

<p>username and password are tightly coupled to local strategy. Change that. </p></li>
<li><h4 id="ddelegatefakeloginusernamepasswordpasswordid1"><code>$delegate.fakeLogin = (username, password = 'password', id = 1) -&gt;</code></h4>

<p>This will change when login method generalization happens. </p></li>
</ul>

<p><a href="./client/modules/pkgman.html">client/modules/pkgman.coffee</a></p>

<ul>
<li><h4 id="continueiferrortostringiserrorcannotfindmodulepackagesname"><code>continue if error.toString() is "Error: Cannot find module 'packages/#{name}'"</code></h4>

<p>Should we let this throw? </p></li>
</ul>

<p><a href="./client/modules/schema-client.html">client/modules/schema-client.coffee</a></p>

<ul>
<li><h4 id="exportsdefineadapteroptions"><code>exports.define = (adapter, options = {}) -&gt;</code></h4>

<p>Don't do the model invocation/definition immediately. </p></li>
</ul>

<p><a href="./server/AbstractHttp.html">server/AbstractHttp.coffee</a></p>

<ul>
<li><h4 id="moduleexportsclassabstracthttp"><code>module.exports = class AbstractHttp</code></h4>

<p>This needs work, it probably wouldn't be able to handle another server in its current state. Move API from Express to here, and use a 'pure virtual' pattern, to allow any other server to extend along reasonable lines. </p></li>
</ul>

<p><a href="./server/AbstractSocketFactory.html">server/AbstractSocketFactory.coffee</a></p>

<ul>
<li><h4 id="moduleexportsclassabstractsocketfactoryextendseventemitter"><code>module.exports = class AbstractSocketFactory extends EventEmitter</code></h4>

<p>This needs work, it probably wouldn't be able to handle another server in its current state. Move API from SocketIo to here. </p></li>
</ul>

<p><a href="./server/config.html">server/config.coffee</a></p>

<ul>
<li><h4 id="dgetthis"><code>$get: -&gt; this</code></h4>

<p>This is Angular-specific. Move it to where it belongs. </p></li>
</ul>

<p><a href="./server/jugglingdb.html">server/jugglingdb.coffee</a></p>

<ul>
<li><h4 id="moduleexportsrequireschemaclientdefine"><code>module.exports = require('schema-client').define(</code></h4>

<p>This module currently immediately attempts to gather package models and create the schema: it should provide a function to lookup that information instead of doing it all at require time. </p></li>
</ul>

<p><a href="./server/packages/angular/index.html">server/packages/angular/index.coffee</a></p>

<ul>
<li><h4 id="deferredpromisedefer"><code>@deferred = Promise.defer()</code></h4>

<p>This should be a queue, not a busy promise. </p></li>
<li><h4 id="return"><code>return</code></h4>

<p>need to extract params to build redirectTo, small enough mismatch to ignore for now. </p></li>
<li><h4 id="sandboxinjectinjectable"><code>sandbox.inject = (injectable) -&gt;</code></h4>

<p>Return a promise, resolved with the dependency array. </p></li>
</ul>

<p><a href="./server/packages/config/index.html">server/packages/config/index.coffee</a></p>

<ul>
<li><h4 id="debuggingproductionisntnconfgetnode_env"><code>debugging: 'production' isnt nconf.get 'NODE_ENV'</code></h4>

<p>Remove this, and implement a client logging system. </p></li>
<li><h4 id="ressend"><code>res.send """</code></h4>

<p>This shouldn't be a module, we can do this better. </p></li>
</ul>

<p><a href="./server/packages/express/index.html">server/packages/express/index.coffee</a></p>

<ul>
<li><h4 id="_appsetviews_configpath"><code>@_app.set 'views', @_config.path</code></h4>

<p>Do we really need to use Express's theme system..? </p></li>
</ul>

<p><a href="./server/packages/form/index.html">server/packages/form/index.coffee</a></p>

<ul>
<li><h4 id="returnnextunlessbodyformkey"><code>return next() unless body.formKey?</code></h4>

<p>CRSF check needed here. </p></li>
</ul>

<p><a href="./server/packages/limiter/index.html">server/packages/limiter/index.coffee</a></p>

<ul>
<li><h4 id="promiseifreqreportvilliany"><code>promise = if req.reportVilliany?</code></h4>

<p>Should this be added by <a href="/server/packages/villiany/index.html">villiany</a>? </p></li>
</ul>

<p><a href="./server/packages/nodemailer/index.html">server/packages/nodemailer/index.coffee</a></p>

<ul>
<li><h4 id="ddatauinavdbodyhtml"><code>$('[data-ui-nav]', $body).html """</code></h4>

<p>this kind of thing should be configurable and handled by the theme/skin when we get to that point. </p></li>
</ul>

<p><a href="./server/packages/rpc/index.html">server/packages/rpc/index.coffee</a></p>

<ul>
<li><h4 id="replyerror"><code>reply = (error) -&gt;</code></h4>

<p>Should be middleware for after a request, <code>session</code> should register into that. </p></li>
</ul>

<p><a href="./server/packages/schema/index.html">server/packages/schema/index.coffee</a></p>

<ul>
<li><h4 id="resset"><code>res.set</code></h4>

<p>Settings-defined headers are what actually make sense here. </p></li>
<li><h4 id="keyifykeyvalue"><code>keyify = (key, value) -&gt;</code></h4>

<p>Generalize and serve "broken" JSON for Angular. See: <a href="http://docs.angularjs.org/api/ng/service/$http#json-vulnerability-protection">Angular JSON vulnerability protection</a>. </p></li>
</ul>

<p><a href="./server/packages/socket/SocketIo.html">server/packages/socket/SocketIo.coffee</a></p>

<ul>
<li><h4 id="reqsockethandshake"><code>req = socket.handshake</code></h4>

<p>Make req an instance of require('http').IncomingMessage if we can do that. </p></li>
</ul>

<p><a href="./server/packages/socket/index.html">server/packages/socket/index.coffee</a></p>

<ul>
<li><h4 id="requestmiddleware"><code>requestMiddleware: [</code></h4>

<p>Rename to connectionMiddleware. </p></li>
<li><h4 id="storeredis"><code>store: 'redis'</code></h4>

<p>This probably doesn't belong here. </p></li>
</ul>

<p><a href="./server/packages/user/index.html">server/packages/user/index.coffee</a></p>

<ul>
<li><h4 id="localstrategyrequirepassportlocalstrategy"><code>LocalStrategy = require('passport-local').Strategy</code></h4>

<p>Strategies should be dynamically defined, probably through a hook. </p></li>
</ul>

<p><a href="./server/packages/user/login.html">server/packages/user/login.coffee</a></p>

<ul>
<li><h4 id="newpromiseresolverejectsettimeoutresolve1000"><code>new Promise (resolve, reject) -&gt; setTimeout resolve, 1000</code></h4>

<p>Remove this. We'll eventually disallow registration conflicts. </p></li>
</ul>

<p><a href="./server/packages/villiany/index.html">server/packages/villiany/index.coffee</a></p>

<ul>
<li><h4 id="banschemadefineban"><code>Ban = schema.define 'Ban',</code></h4>

<p>Generate all of this dynamically from audit keys. </p></li>
</ul>

<p><a href="./server/sandboxes.html">server/sandboxes.coffee</a></p>

<ul>
<li><h4 id="moduleexportsnewclasssandboxfactory"><code>module.exports = new class SandboxFactory</code></h4>

<p>This is probably more of an <code>angular</code> package-specific need. It should probably be moved there and this module should solely provide Sandbox. </p></li>
<li><h4 id="constructorhtmlcookie_idnull"><code>constructor: (html, cookie, @_id = null) -&gt;</code></h4>

<p>Move ID to SandboxFactory. </p></li>
<li><h4 id="toucherif_id"><code>toucher = if @_id?</code></h4>

<p>Move to SandboxFactory. </p></li>
<li><h4 id="urlhttplocalhost"><code>url: "http://localhost:#{</code></h4>

<p>"Entry point" is an <code>angular</code> package-specific idiom. </p></li>
<li><h4 id="moduleexportsremove_id"><code>module.exports.remove @_id</code></h4>

<p>Move to SandboxFactory. </p></li>
<li><h4 id="_busy"><code>@_busy</code></h4>

<p>There should be a worker queue, not a single 'busy' promise. </p></li>
<li><h4 id="isnewtrue"><code>isNew: -&gt; true</code></h4>

<p>Move to SandboxFactory. </p></li>
<li><h4 id="setbusy_busy"><code>setBusy: (@_busy) -&gt;</code></h4>

<p>This is a sloppy interface. </p></li>
</ul></div></div></div></div></body></html>