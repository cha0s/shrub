<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>notifications.coffee - Shrub</title>
  

  <link rel="shortcut icon" href="../../../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../../../css/highlight.css">
  <link href="../../../../css/extra.css" rel="stylesheet">

  
  <script>
    // Current page data
    var mkdocs_page_name = "notifications.coffee";
  </script>
  
  <script src="../../../../js/jquery-2.1.1.min.js"></script>
  <script src="../../../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../../../js/highlight.pack.js"></script>
  <script src="../../../../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../../../.." class="icon icon-home"> Shrub</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../../..">Home</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Guide</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../../guide/getting-started/">Getting started</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../../guide/errors/">Error handling</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../../guide/forms/">Form handling</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../../guide/packages/">Package system</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../../guide/concepts/">Concepts and conventions</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Examples</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../../examples/todo-list/">TODO list app</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Reference</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../../hooks/">Hooks</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../../packages/">Packages</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../../todos/">TODO list</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Source</span></li>

        
            
    <ul class="subnav">
    <li><span>client</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../client/app/">app.coffee</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>modules</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../client/modules/angular/">angular.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../client/modules/config/">config.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../client/modules/config.spec/">config.spec.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../client/modules/errors/">errors.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../client/modules/errors.spec/">errors.spec.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../client/modules/middleware/">middleware.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../client/modules/middleware.spec/">middleware.spec.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../client/modules/pkgman/">pkgman.coffee</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../client/packages/">packages.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../client/require/">require.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>config</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../config/default.settings/">default.settings.yml</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../Gruntfile/">Gruntfile.coffee</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>packages</span></li>

        
            
    <ul class="subnav">
    <li><span>shrub-angular-sandbox</span></li>

        
            
    <ul class="subnav">
    <li><span>client</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-angular-sandbox/client/">index.coffee</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-angular-sandbox/">index.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>shrub-angular</span></li>

        
            
    <ul class="subnav">
    <li><span>client</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-angular/client/">index.coffee</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-angular/">index.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>shrub-assets</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-assets/">index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-assets/jquery/">jquery.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>shrub-config</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-config/">index.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>shrub-core</span></li>

        
            
    <ul class="subnav">
    <li><span>client</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-core/client/">index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-core/client/test-e2e/">test-e2e.coffee</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-core/">index.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>shrub-example</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-example/about/">about.coffee</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>client</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-example/client/about/">about.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-example/client/home/">home.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-example/client/">index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-example/client/test-e2e/">test-e2e.coffee</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-example/">index.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>shrub-form</span></li>

        
            
    <ul class="subnav">
    <li><span>client</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-form/client/">index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-form/client/test-unit/">test-unit.coffee</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>widget</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-form/client/widget/checkbox/">checkbox.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-form/client/widget/checkboxes/">checkboxes.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-form/client/widget/group/">group.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-form/client/widget/hidden/">hidden.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-form/client/widget/markup/">markup.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-form/client/widget/radio/">radio.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-form/client/widget/radios/">radios.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-form/client/widget/select/">select.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-form/client/widget/submit/">submit.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-form/client/widget/text/">text.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-form/client/widget/textarea/">textarea.coffee</a>
        
    </li>

        
    </ul>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-form/">index.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>shrub-grunt</span></li>

        
            
    <ul class="subnav">
    <li><span>dox</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-grunt/dox/dynamic/">dynamic.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-grunt/dox/">index.coffee</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-grunt/">index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-grunt/lint/">lint.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-grunt/modules/">modules.coffee</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>tests</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-grunt/tests/build/">build.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-grunt/tests/">index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-grunt/tests/run/">run.coffee</a>
        
    </li>

        
    </ul>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>shrub-html5-audio</span></li>

        
            
    <ul class="subnav">
    <li><span>client</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-html5-audio/client/">index.coffee</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-html5-audio/">index.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>shrub-html5-local-storage</span></li>

        
            
    <ul class="subnav">
    <li><span>client</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-html5-local-storage/client/">index.coffee</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-html5-local-storage/">index.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>shrub-html5-notification</span></li>

        
            
    <ul class="subnav">
    <li><span>client</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-html5-notification/client/">index.coffee</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-html5-notification/">index.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>shrub-http-express</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-http-express/errors/">errors.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-http-express/">index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-http-express/logger/">logger.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-http-express/routes/">routes.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-http-express/session/">session.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-http-express/static/">static.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>shrub-http</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-http/">index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-http/manager/">manager.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>shrub-install</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-install/">index.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>shrub-limiter</span></li>

        
            
    <ul class="subnav">
    <li><span>client</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-limiter/client/">index.coffee</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-limiter/">index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-limiter/limiter/">limiter.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>shrub-nodemailer</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-nodemailer/">index.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>shrub-orm</span></li>

        
            
    <ul class="subnav">
    <li><span>client</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-orm/client/">index.coffee</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-orm/">index.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>shrub-passport</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-passport/">index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-passport/logout/">logout.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>shrub-repl</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-repl/">index.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>shrub-rpc</span></li>

        
            
    <ul class="subnav">
    <li><span>client</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-rpc/client/">index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-rpc/client/test-unit/">test-unit.coffee</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-rpc/">index.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>shrub-schema-rest</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-schema-rest/">index.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>shrub-session</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-session/">index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-session/store/">store.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>shrub-skin-strapped</span></li>

        
            
    <ul class="subnav">
    <li><span>client</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-skin-strapped/client/form/">form.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-skin-strapped/client/">index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-skin-strapped/client/main-nav/">main-nav.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-skin-strapped/client/notifications/">notifications.coffee</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-skin-strapped/">index.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>shrub-skin</span></li>

        
            
    <ul class="subnav">
    <li><span>client</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-skin/client/">index.coffee</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-skin/">index.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>shrub-socket-socket.io</span></li>

        
            
    <ul class="subnav">
    <li><span>client</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-socket-socket.io/client/">index.coffee</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-socket-socket.io/">index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-socket-socket.io/manager/">manager.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>shrub-socket</span></li>

        
            
    <ul class="subnav">
    <li><span>client</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-socket/client/dummy/">dummy.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-socket/client/">index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-socket/client/socket/">socket.coffee</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-socket/">index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-socket/manager/">manager.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>shrub-ui</span></li>

        
            
    <ul class="subnav">
    <li><span>client</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../client/attributes/">attributes.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../client/">index.coffee</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>list</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../client/list/">index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../client/list/item/">item.coffee</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../client/markdown/">markdown.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../client/menu/">menu.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../client/messages/">messages.coffee</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>notifications</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../client/notifications/">index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../client/notifications/item/">item.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../client/notifications/title/">title.coffee</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../client/test-unit/">test-unit.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../client/window-title/">window-title.coffee</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../">index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">notifications.coffee</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#ui-notifications">UI - Notifications</a></li>
                
                    <li><a class="toctree-l4" href="#implements-hook-shrubcoreprebootstrap">Implements hook shrubCorePreBootstrap</a></li>
                
                    <li><a class="toctree-l4" href="#implements-hook-shrubcorebootstrapmiddleware">Implements hook shrubCoreBootstrapMiddleware</a></li>
                
                    <li><a class="toctree-l4" href="#invoke-hook-shrubuinotificationqueues">Invoke hook shrubUiNotificationQueues</a></li>
                
                    <li><a class="toctree-l4" href="#implements-hook-shrubormcollections">Implements hook shrubOrmCollections</a></li>
                
                    <li><a class="toctree-l4" href="#notification">Notification</a></li>
                
                    <li><a class="toctree-l4" href="#notificationacknowledged">Notification#acknowledged</a></li>
                
                    <li><a class="toctree-l4" href="#notificationmarkedasread">Notification#markedAsRead</a></li>
                
                    <li><a class="toctree-l4" href="#notificationmayremove">Notification#mayRemove</a></li>
                
                    <li><a class="toctree-l4" href="#notificationchannel">Notification#channel</a></li>
                
                    <li><a class="toctree-l4" href="#notificationpath">Notification#path</a></li>
                
                    <li><a class="toctree-l4" href="#notificationqueue">Notification#queue</a></li>
                
                    <li><a class="toctree-l4" href="#notificationvariables">Notification#variables</a></li>
                
                    <li><a class="toctree-l4" href="#notificationcreatefromrequest">Notification#createFromRequest</a></li>
                
                    <li><a class="toctree-l4" href="#notificationqueuefromrequest">Notification#queueFromRequest</a></li>
                
            
            </ul>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>shrub-user-local</span></li>

        
            
    <ul class="subnav">
    <li><span>client</span></li>

        
            
    <ul class="subnav">
    <li><span>email</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-user-local/client/email/forgot/">forgot.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-user-local/client/email/">index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-user-local/client/email/register/">register.coffee</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-user-local/client/forgot/">forgot.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-user-local/client/">index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-user-local/client/register/">register.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-user-local/client/reset/">reset.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-user-local/client/test-e2e/">test-e2e.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-user-local/client/test-unit/">test-unit.coffee</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-user-local/forgot/">forgot.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-user-local/">index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-user-local/register/">register.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-user-local/reset/">reset.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>shrub-user-reddit</span></li>

        
            
    <ul class="subnav">
    <li><span>client</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-user-reddit/client/">index.coffee</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-user-reddit/">index.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>shrub-user</span></li>

        
            
    <ul class="subnav">
    <li><span>client</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-user/client/">index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-user/client/login/">login.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-user/client/logout/">logout.coffee</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-user/">index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-user/login/">login.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>shrub-villiany</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shrub-villiany/">index.coffee</a>
        
    </li>

        
    </ul>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../server/">server.coffee</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>server</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../server/bootstrap/">bootstrap.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../server/config/">config.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../server/crypto/">crypto.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../server/crypto.spec/">crypto.spec.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../server/fingerprint/">fingerprint.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../server/logging/">logging.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../server/sandboxes/">sandboxes.coffee</a>
        
    </li>

        
    </ul>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../..">Shrub</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../..">Docs</a> &raquo;</li>
    
      
        
          <li>shrub-ui &raquo;</li>
        
      
    
    <li>notifications.coffee</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/cha0s/shrub" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="ui-notifications">UI - Notifications</h1>
<pre><code class="coffeescript">Promise = null

orm = null

notificationQueues = {}

exports.pkgmanRegister = (registrar) -&gt;
</code></pre>

<h4 id="implements-hook-shrubcoreprebootstrap">Implements hook <a href="../../../../hooks#shrubcoreprebootstrap"><code>shrubCorePreBootstrap</code></a></h4>
<pre><code class="coffeescript">  registrar.registerHook 'shrubCorePreBootstrap', -&gt;

    Promise = require 'bluebird'

    orm = require 'shrub-orm'
</code></pre>

<h4 id="implements-hook-shrubcorebootstrapmiddleware">Implements hook <a href="../../../../hooks#shrubcorebootstrapmiddleware"><code>shrubCoreBootstrapMiddleware</code></a></h4>
<pre><code class="coffeescript">  registrar.registerHook 'shrubCoreBootstrapMiddleware', -&gt;

    pkgman = require 'pkgman'

    label: 'Register notification queues'
    middleware: [

      (next) -&gt;
</code></pre>

<h4 id="invoke-hook-shrubuinotificationqueues">Invoke hook <a href="../../../../hooks#shrubuinotificationqueues"><code>shrubUiNotificationQueues</code></a></h4>
<pre><code class="coffeescript">        for path, queues of pkgman.invoke 'shrubUiNotificationQueues'
          for name, queue of queues
            notificationQueues[pkgman.normalizePath name] = queue

        next()

    ]
</code></pre>

<p>Broadcast a notification event.</p>
<pre><code class="coffeescript">  broadcastNotificationsEvent = (req, args) -&gt;

    {manager: socketManager} = require 'shrub-socket'

    {data, event, includeSelf, notifications} = args
    data ?= {}
</code></pre>

<p>Broadcast for each queue.</p>
<pre><code class="coffeescript">    queueMap = {}
    for notification in notifications
      queueMap[notification.queue] ?= []
      queueMap[notification.queue].push notification.id

    for queueName, ids of queueMap
      queue = notificationQueues[queueName]
      channel = queue.channelFromRequest req

      data.ids = ids
      data.queue = queueName

      if includeSelf
        socketManager().broadcast channel, event, data
      else
        req.socket.broadcast.to(channel).emit event, data
</code></pre>

<h4 id="implements-hook-shrubormcollections">Implements hook <a href="../../../../hooks#shrubormcollections"><code>shrubOrmCollections</code></a></h4>
<pre><code class="coffeescript">  registrar.registerHook 'shrubOrmCollections', -&gt;
</code></pre>

<h2 id="notification">Notification</h2>
<pre><code class="coffeescript">    Notification =

      attributes:
</code></pre>

<h2 id="notificationacknowledged">Notification#acknowledged</h2>
<p><em>Has the notification been acknowledged?</em></p>
<pre><code class="coffeescript">        acknowledged:
          type: 'boolean'
          defaultsTo: false
</code></pre>

<h2 id="notificationmarkedasread">Notification#markedAsRead</h2>
<p><em>Has the notification been read?</em></p>
<pre><code class="coffeescript">        markedAsRead:
          type: 'boolean'
          defaultsTo: false
</code></pre>

<h2 id="notificationmayremove">Notification#mayRemove</h2>
<p><em>May this notification be removed?</em></p>
<pre><code class="coffeescript">        mayRemove:
          type: 'boolean'
          defaultsTo: true
</code></pre>

<h2 id="notificationchannel">Notification#channel</h2>
<p><em>Which channel owns this notification? Built by the queue.</em></p>
<pre><code class="coffeescript">        channel: 'string'
</code></pre>

<h2 id="notificationpath">Notification#path</h2>
<p><em>To where does this notification link?</em></p>
<pre><code class="coffeescript">        path: 'string'
</code></pre>

<h2 id="notificationqueue">Notification#queue</h2>
<p><em>To which queue does this notification belong?</em></p>
<pre><code class="coffeescript">        queue:
          type: 'string'
          notEmpty: true
</code></pre>

<h2 id="notificationvariables">Notification#variables</h2>
<p><em>Variables, can be any type.</em></p>
<pre><code class="coffeescript">        variables: 'json'
</code></pre>

<h2 id="notificationcreatefromrequest">Notification#createFromRequest</h2>
<ul>
<li>
<p>(http.IncomingMessage) <code>req</code> - The request object.</p>
</li>
<li>
<p>(String) <code>queueName</code> - The name of the queue.</p>
</li>
<li>
<p>(Object) <code>variables</code> - Arbitrary data. Defaults to <code>{}</code>.</p>
</li>
<li>
<p>(String) <code>path</code> - Path this notification links to. Defaults to</p>
</li>
</ul>
<p><code>'javascript:void(0)'</code>.</p>
<ul>
<li>(Boolean) <code>mayRemove</code> - May this notification be removed from the
queue by</li>
</ul>
<p>the user? Defaults to <code>true</code>. <em>Create a notification from a request
object.</em></p>
<pre><code class="coffeescript">      createFromRequest: (req, queueName, variables, path, mayRemove) -&gt;
</code></pre>

<p>Check that the queue is valid.</p>
<pre><code class="coffeescript">        unless queue = notificationQueues[queueName]
          return Promise.reject new Error(
            &quot;Notification queue `#{queue}' doesn't exist.&quot;
          )
</code></pre>

<p>Defaults.</p>
<pre><code class="coffeescript">        mayRemove ?= true
        path ?= 'javascript:void(0)'
        variables ?= {}
</code></pre>

<p>Get the channel from the request.</p>
<pre><code class="coffeescript">        return unless (channel = queue.channelFromRequest req)?
</code></pre>

<p>Create the notification.</p>
<pre><code class="coffeescript">        @create(
          mayRemove: mayRemove
          channel: channel
          path: path
          queue: queueName
          variables: variables

        ).then (notification) -&gt;
          return unless req.socket?
</code></pre>

<p>Broadcast to others.</p>
<pre><code class="coffeescript">          notification.redactFor(req.user).then (notification) -&gt;
            broadcastNotificationsEvent(
              req
              data: notifications: [notification]
              event: 'shrub-ui/notifications'
              includeSelf: true
              notifications: [notification]
            )
</code></pre>

<h2 id="notificationqueuefromrequest">Notification#queueFromRequest</h2>
<ul>
<li>(http.IncomingMessage) <code>req</code> - The request object.</li>
</ul>
<p><em>Get a queue's notifications from a request.</em></p>
<pre><code class="coffeescript">      queueFromRequest: (req) -&gt;
</code></pre>

<p>Empty queue if none was defined.</p>
<pre><code class="coffeescript">        unless (queue = notificationQueues[req.body.queue])?
          return Promise.resolve []

        unless (channel = queue.channelFromRequest req)?
          return Promise.resolve []
</code></pre>

<p>Return the 20 newest notifications from the queue for the request's
channel, skipping as many records as requested.</p>
<pre><code class="coffeescript">        query = @find()
        query = query.where(channel: channel)
        query = query.where(queue: req.body.queue)
        query = query.skip(req.body.skip ? 0)
        query = query.limit(20)
        query.sort('createdAt DESC')
</code></pre>

<p>Redact the notifications before sending them over the wire.</p>
<pre><code class="coffeescript">        query.then (notifications) -&gt;
          Promise.all(
            notifications.map (notification) -&gt;
              notification.redactFor req.user
          )
</code></pre>

<p>Remove unnecessary details.</p>
<pre><code class="coffeescript">      redactors: [(redactFor) -&gt;
        self = this

        delete self.channel
        delete self.updatedAt

      ]

    'shrub-ui-notification': Notification
</code></pre>

<h4 id="implements-hook-shrubconfigclient">Implements hook <a href="../../../../hooks#shrubconfigclient"><code>shrubConfigClient</code></a></h4>
<pre><code class="coffeescript">  registrar.registerHook 'shrubConfigClient', (req) -&gt;
</code></pre>

<p>Make sure ORM is up (it won't be when grunt is running).</p>
<pre><code class="coffeescript">    return unless Notification = orm?.collection 'shrub-ui-notification'
</code></pre>

<p>Get all the notification queues.</p>
<pre><code class="coffeescript">    promiseKeys = []
    promises = for key, queue of notificationQueues
      promiseKeys.push key

      (req.body ?= {}).queue = key
      Notification.queueFromRequest req
</code></pre>

<p>Load any queues into the config.</p>
<pre><code class="coffeescript">    Promise.all(promises).then (notificationsList) -&gt;
      queuesConfig = null

      for notifications, index in notificationsList
        continue if notifications.length is 0
</code></pre>

<p>Reverse the notifications because the client will prepend new
notifications, not append.</p>
<pre><code class="coffeescript">        queuesConfig ?= {}
        queuesConfig[promiseKeys[index]] = notifications.reverse()

      queuesConfig
</code></pre>

<p>Ensure that the requested notification is owned by the request.</p>
<pre><code class="coffeescript">  ensureNotificationsOwnedByRequest = (req, res, next) -&gt;

    Notification = orm.collection 'shrub-ui-notification'
    Notification.findById(req.body.ids).then((notifications) -&gt;

      for notification in notifications
        return next new Error(
          &quot;Notification queue `#{notification.queue}' doesn't exist.&quot;
        ) unless queue = notificationQueues[notification.queue]

        return next new Error(
          &quot;You don't own those notifications.&quot;
        ) unless notification.channel is queue.channelFromRequest req

      req.notifications = notifications
      next()

    ).catch next
</code></pre>

<h4 id="implements-hook-shrubrpcroutes">Implements hook <a href="../../../../hooks#shrubrpcroutes"><code>shrubRpcRoutes</code></a></h4>
<pre><code class="coffeescript">  registrar.registerHook 'shrubRpcRoutes', -&gt;

    routes = []

    routes.push

      path: 'shrub-ui/notifications/acknowledged'

      middleware: [
</code></pre>

<p>Ensure that the queue exists.</p>
<pre><code class="coffeescript">        (req, res, next) -&gt;
          return next new Error(
            &quot;Notification queue `#{req.body.queue}' doesn't exist.&quot;
          ) unless queue = notificationQueues[req.body.queue]

          req.queue = queue
          next()

        (req, res, next) -&gt;
</code></pre>

<p>Mark all notifications in a queue owned by the request as
acknowledged.</p>
<pre><code class="coffeescript">          Notification = orm.collection 'shrub-ui-notification'
          query = Notification.find()
          query = query.where(channel: req.queue.channelFromRequest req)
          query = query.where(queue: req.body.queue)
          query.then((notifications) -&gt;
</code></pre>

<p>Broadcast to others.</p>
<pre><code class="coffeescript">            broadcastNotificationsEvent(
              req
              event: 'shrub-ui/notifications/acknowledged'
              notifications: notifications
            )

            Promise.all(
              for notification in notifications
                notification.acknowledged = true
                notification.save()
            )

          ).then(-&gt; res.end()).catch next

      ]

    routes.push

      path: 'shrub-ui/notifications/markAsRead'

      middleware: [

        ensureNotificationsOwnedByRequest

        (req, res, next) -&gt;
</code></pre>

<p>Broadcast to others.</p>
<pre><code class="coffeescript">          broadcastNotificationsEvent(
            req
            data: markedAsRead: req.body.markedAsRead
            event: 'shrub-ui/notifications/markAsRead'
            notifications: req.notifications
          )

          Promise.all(
            for notification in req.notifications
              notification.markedAsRead = req.body.markedAsRead
              notification.save()

          ).then(-&gt; res.end()).catch next

      ]

    routes.push

      path: 'shrub-ui/notifications/remove'

      middleware: [

        ensureNotificationsOwnedByRequest
</code></pre>

<p>Ensure that the requested notifications may be removed.</p>
<pre><code class="coffeescript">        (req, res, next) -&gt;

          for notification in req.notifications
            return next new Error(
              'Those notifications may not be removed.'
            ) unless notification.mayRemove

          next()

        (req, res, next) -&gt;
</code></pre>

<p>Broadcast to others.</p>
<pre><code class="coffeescript">          broadcastNotificationsEvent(
            req
            event: 'shrub-ui/notifications/remove'
            notifications: req.notifications
          )

          Promise.all(
            for notification in req.notifications
              notification.destroy()

          ).then(-&gt; res.end()).catch next

      ]

    routes.push

      path: 'shrub-ui/notifications'

      middleware: (req, res, next) -&gt;

        Notification = orm.collection 'shrub-ui-notification'
        Notification.queueFromRequest(req).then((notifications) -&gt;

          res.end notifications

        ).catch next

    return routes
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../shrub-user-local/client/email/forgot/" class="btn btn-neutral float-right" title="forgot.coffee"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../" class="btn btn-neutral" title="index.coffee"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../shrub-user-local/client/email/forgot/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
