<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>packages/shrub-ui/notifications.litcoffee - Shrub</title>
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../../../css/highlight.css">
  <link href="../../../../css/extra.css" rel="stylesheet">

  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
  <script type="text/javascript" src="../../../../js/highlight.pack.js"></script>
  <script src="../../../../js/theme.js"></script>

  <style>
    body {font-size: 90%;}
    pre, code {font-size: 100%;}
    h3, h4, h5, h6 {color: #2980b9; font-weight: 300}
  </style> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../../../.." class="icon icon-home"> Shrub</a>
        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
      <ul class="current">
    
        
        <span>Guide</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../../../guide/getting-started">Getting Started</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../../../guide/forms">Form handling</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../../../guide/concepts">Concepts and conventions</a>
                    
                </li>
            
        

    
        
        <span>Reference</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../../../hooks">Hooks</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../../../packages">Packages</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../../../todos">TODO list</a>
                    
                </li>
            
        

    
        
        <span>Source code</span>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../../Gruntfile">Gruntfile.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../../client/app">client/app.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../../client/modules/angular">client/modules/angular.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../../client/modules/config">client/modules/config.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../../client/modules/errors">client/modules/errors.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../../client/modules/logging">client/modules/logging.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../../client/modules/middleware">client/modules/middleware.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../../client/modules/pkgman">client/modules/pkgman.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../../client/packages">client/packages.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../../client/require">client/require.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-angular-sandbox/client">packages/shrub-angular-sandbox/client/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-angular-sandbox">packages/shrub-angular-sandbox/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-angular/client">packages/shrub-angular/client/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-angular">packages/shrub-angular/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-assets/angular">packages/shrub-assets/angular.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-assets">packages/shrub-assets/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-assets/jquery">packages/shrub-assets/jquery.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-audit/fingerprint">packages/shrub-audit/fingerprint.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-audit">packages/shrub-audit/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-config">packages/shrub-config/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-core/client">packages/shrub-core/client/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-core">packages/shrub-core/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-example/about">packages/shrub-example/about.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-example/client/about">packages/shrub-example/client/about.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-example/client/home">packages/shrub-example/client/home.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-example/client">packages/shrub-example/client/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-example">packages/shrub-example/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-form/client">packages/shrub-form/client/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-form/client/widget/checkbox">packages/shrub-form/client/widget/checkbox.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-form/client/widget/checkboxes">packages/shrub-form/client/widget/checkboxes.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-form/client/widget/hidden">packages/shrub-form/client/widget/hidden.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-form/client/widget/radio">packages/shrub-form/client/widget/radio.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-form/client/widget/radios">packages/shrub-form/client/widget/radios.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-form/client/widget/select">packages/shrub-form/client/widget/select.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-form/client/widget/submit">packages/shrub-form/client/widget/submit.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-form/client/widget/text">packages/shrub-form/client/widget/text.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-form">packages/shrub-form/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-grunt/dox/dynamic">packages/shrub-grunt/dox/dynamic.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-grunt/dox">packages/shrub-grunt/dox/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-grunt">packages/shrub-grunt/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-grunt/lint">packages/shrub-grunt/lint.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-grunt/modules">packages/shrub-grunt/modules.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-grunt/tests/build">packages/shrub-grunt/tests/build.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-grunt/tests">packages/shrub-grunt/tests/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-grunt/tests/run">packages/shrub-grunt/tests/run.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-html5-local-storage/client">packages/shrub-html5-local-storage/client/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-html5-local-storage">packages/shrub-html5-local-storage/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-html5-notification/client">packages/shrub-html5-notification/client/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-html5-notification">packages/shrub-html5-notification/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-http-express/errors">packages/shrub-http-express/errors.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-http-express">packages/shrub-http-express/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-http-express/logger">packages/shrub-http-express/logger.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-http-express/routes">packages/shrub-http-express/routes.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-http-express/session">packages/shrub-http-express/session.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-http-express/static">packages/shrub-http-express/static.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-http">packages/shrub-http/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-http/manager">packages/shrub-http/manager.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-install">packages/shrub-install/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-limiter/client">packages/shrub-limiter/client/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-limiter">packages/shrub-limiter/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-limiter/limiter">packages/shrub-limiter/limiter.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-nodemailer">packages/shrub-nodemailer/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-orm/client">packages/shrub-orm/client/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-orm">packages/shrub-orm/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-repl">packages/shrub-repl/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-rpc/client">packages/shrub-rpc/client/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-rpc">packages/shrub-rpc/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-session">packages/shrub-session/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-session/store">packages/shrub-session/store.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-skin-strapped/client">packages/shrub-skin-strapped/client/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-skin-strapped/client/main-nav">packages/shrub-skin-strapped/client/main-nav.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-skin-strapped/client/notifications">packages/shrub-skin-strapped/client/notifications.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-skin-strapped">packages/shrub-skin-strapped/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-skin/client">packages/shrub-skin/client/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-skin">packages/shrub-skin/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-socket-socket.io/client">packages/shrub-socket-socket.io/client/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-socket-socket.io">packages/shrub-socket-socket.io/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-socket-socket.io/manager">packages/shrub-socket-socket.io/manager.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-socket/client/dummy">packages/shrub-socket/client/dummy.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-socket/client">packages/shrub-socket/client/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-socket/client/socket">packages/shrub-socket/client/socket.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-socket">packages/shrub-socket/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-socket/manager">packages/shrub-socket/manager.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../client/attributes">packages/shrub-ui/client/attributes.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../client">packages/shrub-ui/client/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../client/list">packages/shrub-ui/client/list/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../client/list/item">packages/shrub-ui/client/list/item.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../client/markdown">packages/shrub-ui/client/markdown.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../client/menu">packages/shrub-ui/client/menu.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../client/messages">packages/shrub-ui/client/messages.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../client/notifications">packages/shrub-ui/client/notifications/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../client/notifications/item">packages/shrub-ui/client/notifications/item.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../client/notifications/title">packages/shrub-ui/client/notifications/title.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../client/window-title">packages/shrub-ui/client/window-title.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="..">packages/shrub-ui/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 current">
                    <a class="current" href=".">packages/shrub-ui/notifications.litcoffee</a>
                    
                        <ul>
                        
                            <li class="toctree-l2"><a href="#ui-notifications">UI - Notifications</a></li>
                            
                                <li><a class="toctree-l3" href="#implements-hook-shrubcoreprebootstrap">Implements hook shrubCorePreBootstrap.</a></li>
                            
                                <li><a class="toctree-l3" href="#implements-hook-shrubcorebootstrapmiddleware">Implements hook shrubCoreBootstrapMiddleware.</a></li>
                            
                                <li><a class="toctree-l3" href="#invoke-hook-shrubuinotificationqueues">Invoke hook shrubUiNotificationQueues.</a></li>
                            
                                <li><a class="toctree-l3" href="#implements-hook-shrubormcollections">Implements hook shrubOrmCollections.</a></li>
                            
                                <li><a class="toctree-l3" href="#notification">Notification</a></li>
                            
                                <li><a class="toctree-l3" href="#notificationacknowledged">Notification#acknowledged</a></li>
                            
                                <li><a class="toctree-l3" href="#notificationmarkedasread">Notification#markedAsRead</a></li>
                            
                                <li><a class="toctree-l3" href="#notificationmayremove">Notification#mayRemove</a></li>
                            
                                <li><a class="toctree-l3" href="#notificationchannel">Notification#channel</a></li>
                            
                                <li><a class="toctree-l3" href="#notificationpath">Notification#path</a></li>
                            
                                <li><a class="toctree-l3" href="#notificationqueue">Notification#queue</a></li>
                            
                                <li><a class="toctree-l3" href="#notificationvariables">Notification#variables</a></li>
                            
                                <li><a class="toctree-l3" href="#notificationcreatefromrequest">Notification#createFromRequest</a></li>
                            
                                <li><a class="toctree-l3" href="#notificationqueuefromrequest">Notification#queueFromRequest</a></li>
                            
                        
                        </ul>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-user/client/email/forgot">packages/shrub-user/client/email/forgot.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-user/client/email">packages/shrub-user/client/email/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-user/client/email/register">packages/shrub-user/client/email/register.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-user/client/forgot">packages/shrub-user/client/forgot.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-user/client">packages/shrub-user/client/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-user/client/login">packages/shrub-user/client/login.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-user/client/logout">packages/shrub-user/client/logout.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-user/client/register">packages/shrub-user/client/register.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-user/client/reset">packages/shrub-user/client/reset.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-user/forgot">packages/shrub-user/forgot.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-user">packages/shrub-user/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-user/login">packages/shrub-user/login.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-user/logout">packages/shrub-user/logout.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-user/register">packages/shrub-user/register.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-user/reset">packages/shrub-user/reset.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../shrub-villiany">packages/shrub-villiany/index.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../../server">server.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../../server/bootstrap">server/bootstrap.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../../server/config">server/config.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../../server/crypto">server/crypto.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../../server/logging">server/logging.litcoffee</a>
                    
                </li>
            
                <li class="toctree-l1 ">
                    <a class="" href="../../../server/sandboxes">server/sandboxes.litcoffee</a>
                    
                </li>
            
        

    
</ul>

      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="icon icon-reorder"></i>
        <a href="../../../.."></a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../..">Docs</a> &raquo;</li>
    <li>packages/shrub-ui/notifications.litcoffee</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="https://github.com/cha0s/shrub" class="icon icon-github"> Edit on GitHub</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              <h1 id="ui-notifications">UI - Notifications</h1>
<pre><code>Promise = null

orm = null

notificationQueues = {}

exports.pkgmanRegister = (registrar) -&gt;
</code></pre>
<h4 id="implements-hook-shrubcoreprebootstrap">Implements hook <code>shrubCorePreBootstrap</code>.</h4>
<pre><code>  registrar.registerHook 'shrubCorePreBootstrap', -&gt;

    Promise = require 'bluebird'

    orm = require 'shrub-orm'
</code></pre>
<h4 id="implements-hook-shrubcorebootstrapmiddleware">Implements hook <code>shrubCoreBootstrapMiddleware</code>.</h4>
<pre><code>  registrar.registerHook 'shrubCoreBootstrapMiddleware', -&gt;

    pkgman = require 'pkgman'

    label: 'Register notification queues'
    middleware: [

      (next) -&gt;
</code></pre>
<h4 id="invoke-hook-shrubuinotificationqueues">Invoke hook <code>shrubUiNotificationQueues</code>.</h4>
<pre><code>        for path, queues of pkgman.invoke 'shrubUiNotificationQueues'
          for name, queue of queues
            notificationQueues[pkgman.normalizePath name] = queue

        next()

    ]
</code></pre>
<p>Broadcast a notification event.</p>
<pre><code>  broadcastNotificationsEvent = (req, args) -&gt;

    {manager: socketManager} = require 'shrub-socket'

    {data, event, includeSelf, notifications} = args
    data ?= {}
</code></pre>
<p>Broadcast for each queue.</p>
<pre><code>    queueMap = {}
    for notification in notifications
      queueMap[notification.queue] ?= []
      queueMap[notification.queue].push notification.id

    for queueName, ids of queueMap
      queue = notificationQueues[queueName]
      channel = queue.channelFromRequest req

      data.ids = ids
      data.queue = queueName

      if includeSelf
        socketManager().broadcast channel, event, data
      else
        req.socket.broadcast.to(channel).emit event, data
</code></pre>
<h4 id="implements-hook-shrubormcollections">Implements hook <code>shrubOrmCollections</code>.</h4>
<pre><code>  registrar.registerHook 'shrubOrmCollections', -&gt;
</code></pre>
<h2 id="notification">Notification</h2>
<pre><code>    Notification =

      attributes:
</code></pre>
<h2 id="notificationacknowledged">Notification#acknowledged</h2>
<p><em>Has the notification been acknowledged?</em></p>
<pre><code>        acknowledged:
          type: 'boolean'
          defaultsTo: false
</code></pre>
<h2 id="notificationmarkedasread">Notification#markedAsRead</h2>
<p><em>Has the notification been read?</em></p>
<pre><code>        markedAsRead:
          type: 'boolean'
          defaultsTo: false
</code></pre>
<h2 id="notificationmayremove">Notification#mayRemove</h2>
<p><em>May this notification be removed?</em></p>
<pre><code>        mayRemove:
          type: 'boolean'
          defaultsTo: true
</code></pre>
<h2 id="notificationchannel">Notification#channel</h2>
<p><em>Which channel owns this notification? Built by the queue.</em></p>
<pre><code>        channel: 'string'
</code></pre>
<h2 id="notificationpath">Notification#path</h2>
<p><em>To where does this notification link?</em></p>
<pre><code>        path: 'string'
</code></pre>
<h2 id="notificationqueue">Notification#queue</h2>
<p><em>To which queue does this notification belong?</em></p>
<pre><code>        queue:
          type: 'string'
          notEmpty: true
</code></pre>
<h2 id="notificationvariables">Notification#variables</h2>
<p><em>Variables, can be any type.</em></p>
<pre><code>        variables: 'json'
</code></pre>
<h2 id="notificationcreatefromrequest">Notification#createFromRequest</h2>
<ul>
<li>(http.IncomingMessage) <code>req</code> - The request object.</li>
<li>(String) <code>queueName</code> - The name of the queue.</li>
<li>(Object) <code>variables</code> - Arbitrary data. Defaults to <code>{}</code>.</li>
<li>(String) <code>path</code> - Path this notification links to. Defaults to
  <code>'javascript:void(0)'</code>.</li>
<li>(Boolean) <code>mayRemove</code> - May this notification be removed from the queue by
  the user? Defaults to <code>true</code>.</li>
</ul>
<p><em>Create a notification from a request object.</em></p>
<pre><code>      createFromRequest: (req, queueName, variables, path, mayRemove) -&gt;
</code></pre>
<p>Check that the queue is valid.</p>
<pre><code>        unless queue = notificationQueues[queueName]
          return Promise.reject new Error(
            "Notification queue `#{queue}' doesn't exist."
          )
</code></pre>
<p>Defaults.</p>
<pre><code>        mayRemove ?= true
        path ?= 'javascript:void(0)'
        variables ?= {}
</code></pre>
<p>Get the channel from the request.</p>
<pre><code>        return unless (channel = queue.channelFromRequest req)?
</code></pre>
<p>Create the notification.</p>
<pre><code>        @create(
          mayRemove: mayRemove
          channel: channel
          path: path
          queue: queueName
          variables: variables

        ).then (notification) -&gt;
          return unless req.socket?
</code></pre>
<p>Broadcast to others.</p>
<pre><code>          notification.redactFor(req.user).then (notification) -&gt;
            broadcastNotificationsEvent(
              req
              data: notifications: [notification]
              event: 'shrub-ui/notifications'
              includeSelf: true
              notifications: [notification]
            )
</code></pre>
<h2 id="notificationqueuefromrequest">Notification#queueFromRequest</h2>
<ul>
<li>(http.IncomingMessage) <code>req</code> - The request object.</li>
</ul>
<p><em>Get a queue's notifications from a request.</em></p>
<pre><code>      queueFromRequest: (req) -&gt;
</code></pre>
<p>Empty queue if none was defined.</p>
<pre><code>        unless (queue = notificationQueues[req.body.queue])?
          return Promise.resolve []

        unless (channel = queue.channelFromRequest req)?
          return Promise.resolve []
</code></pre>
<p>Return the 20 newest notifications from the queue for the request's channel,
skipping as many records as requested.</p>
<pre><code>        query = @find()
        query = query.where(channel: channel)
        query = query.where(queue: req.body.queue)
        query = query.skip(req.body.skip ? 0)
        query = query.limit(20)
        query.sort('createdAt DESC')
</code></pre>
<p>Redact the notifications before sending them over the wire.</p>
<pre><code>        query.then (notifications) -&gt;
          Promise.all(
            notifications.map (notification) -&gt;
              notification.redactFor req.user
          )
</code></pre>
<p>Remove unnecessary details.</p>
<pre><code>      redactors: [(redactFor) -&gt;
        self = this

        delete self.channel
        delete self.updatedAt

      ]

    'shrub-ui-notification': Notification
</code></pre>
<h4 id="implements-hook-shrubconfigclient">Implements hook <code>shrubConfigClient</code>.</h4>
<pre><code>  registrar.registerHook 'shrubConfigClient', (req) -&gt;
</code></pre>
<p>Make sure ORM is up (it won't be when grunt is running).</p>
<pre><code>    return unless Notification = orm?.collection 'shrub-ui-notification'
</code></pre>
<p>Get all the notification queues.</p>
<pre><code>    promiseKeys = []
    promises = for key, queue of notificationQueues
      promiseKeys.push key

      (req.body ?= {}).queue = key
      Notification.queueFromRequest req
</code></pre>
<p>Load any queues into the config.</p>
<pre><code>    Promise.all(promises).then (notificationsList) -&gt;
      queuesConfig = null

      for notifications, index in notificationsList
        continue if notifications.length is 0
</code></pre>
<p>Reverse the notifications because the client will prepend new notifications,
not append.</p>
<pre><code>        queuesConfig ?= {}
        queuesConfig[promiseKeys[index]] = notifications.reverse()

      queuesConfig

  ensureQueueExists = (req, res, next) -&gt;
    return next new Error(
      "Notification queue `#{req.body.queue}' doesn't exist."
    ) unless queue = notificationQueues[req.body.queue]

    req.queue = queue
    next()
</code></pre>
<p>Ensure that the requested notification is owned by the request.</p>
<pre><code>  ensureNotificationsOwnedByRequest = (req, res, next) -&gt;

    Notification = orm.collection 'shrub-ui-notification'
    Notification.findById(req.body.ids).then((notifications) -&gt;

      for notification in notifications
        return next new Error(
          "Notification queue `#{notification.queue}' doesn't exist."
        ) unless queue = notificationQueues[notification.queue]

        return next new Error(
          "You don't own those notifications."
        ) unless notification.channel is queue.channelFromRequest req

      req.notifications = notifications
      next()

    ).catch next
</code></pre>
<h4 id="implements-hook-shrubrpcroutes">Implements hook <code>shrubRpcRoutes</code>.</h4>
<pre><code>  registrar.registerHook 'shrubRpcRoutes', -&gt;

    routes = []

    routes.push

      path: 'shrub-ui/notifications/acknowledged'

      validators: [
        ensureQueueExists
      ]

      receiver: (req, fn) -&gt;
</code></pre>
<p>Mark all notifications in a queue owned by the request as acknowledged.</p>
<pre><code>        Notification = orm.collection 'shrub-ui-notification'
        query = Notification.find()
        query = query.where(channel: req.queue.channelFromRequest req)
        query = query.where(queue: req.body.queue)
        query.then((notifications) -&gt;
</code></pre>
<p>Broadcast to others.</p>
<pre><code>          broadcastNotificationsEvent(
            req
            event: 'shrub-ui/notifications/acknowledged'
            notifications: notifications
          )

          Promise.all(
            for notification in notifications
              notification.acknowledged = true
              notification.save()
          )

        ).then(-&gt; fn()).catch fn

    routes.push

      path: 'shrub-ui/notifications/markAsRead'

      validators: [
        ensureNotificationsOwnedByRequest
      ]

      receiver: (req, fn) -&gt;
</code></pre>
<p>Broadcast to others.</p>
<pre><code>        broadcastNotificationsEvent(
          req
          data: markedAsRead: req.body.markedAsRead
          event: 'shrub-ui/notifications/markAsRead'
          notifications: req.notifications
        )

        Promise.all(
          for notification in req.notifications
            notification.markedAsRead = req.body.markedAsRead
            notification.save()

        ).then(-&gt; fn()).catch fn

    routes.push

      path: 'shrub-ui/notifications/remove'

      validators: [
        ensureNotificationsOwnedByRequest
</code></pre>
<p>Ensure that the requested notifications may be removed.</p>
<pre><code>        (req, res, next) -&gt;

          for notification in req.notifications
            return next new Error(
              'Those notifications may not be removed.'
            ) unless notification.mayRemove

          next()

      ]

      receiver: (req, fn) -&gt;
</code></pre>
<p>Broadcast to others.</p>
<pre><code>        broadcastNotificationsEvent(
          req
          event: 'shrub-ui/notifications/remove'
          notifications: req.notifications
        )

        Promise.all(
          for notification in req.notifications
            notification.destroy()

        ).then(-&gt; fn()).catch fn

    routes.push

      path: 'shrub-ui/notifications'

      receiver: (req, fn) -&gt;

        Notification = orm.collection 'shrub-ui-notification'
        Notification.queueFromRequest(req).then((notifications) -&gt;

          fn null, notifications

        ).catch fn

    return routes
</code></pre>

            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../shrub-user/client/email/forgot" class="btn btn-neutral float-right" title="packages/shrub-user/client/email/forgot.litcoffee"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href=".." class="btn btn-neutral" title="packages/shrub-ui/index.litcoffee"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
    <!-- Copyright etc -->
    </p>
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
        
            <a class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
        
      <span><a href=".." style="color: #fcfcfc;">&laquo; Previous</a></span>
      <span style="margin-left: 15px"><a href="../../shrub-user/client/email/forgot" style="color: #fcfcfc">Next &raquo;</a></span>
    </span>
</div>
</body>
</html>